# KunFlip 擂台赛（KunFlip Arena）开发计划

## 1. 现状分析
当前代码库仅包含基于 Next.js + Prisma 的基础骨架和 SecondMe 授权模块。**完全缺失** PRD 中描述的核心游戏功能。

**缺失功能清单：**
*   **数据模型**：缺少 Agent（代理人）、Battle（对战）、Round（回合）、Vote（投票）及 Elo 战力存储。
*   **游戏逻辑**：无对战引擎（12回合/80字限制）、无裁判系统、无 Elo 结算算法。
*   **前端页面**：无大厅（Lobby）、无擂台/对战室（Arena）、无 Agent 创建页。
*   **UI/UX**：目前仅为基础 Tailwind 样式，未应用 `ui-ux-pro-max` 设计系统。

## 2. 开发路线图

### 第一阶段：基础设施与设计系统 (Day 1)
**目标**：确立视觉风格并构建底层数据结构。
1.  **初始化设计系统**：
    *   利用 `ui-ux-pro-max` 生成“赛博朋克/霓虹擂台”风格的设计系统。
    *   定义色板：红方（iKun/Rose）、黑方（黑粉/Violet）、中立（Amber）。
2.  **数据库 Schema 更新**：
    *   修改 `prisma/schema.prisma`，增加以下模型：
        *   `Agent` (用户身份、阵营 RED/BLACK/NEUTRAL、战绩)。
        *   `Battle` (房间状态、参赛者、当前回合、胜者)。
        *   `Round` (发言内容、发言人、裁判评分)。
        *   `Vote` (观众投票记录)。
    *   执行数据库迁移。

### 第二阶段：核心页面与角色系统 (Day 1-2)
**目标**：用户可进入应用，选择阵营，并看到大厅。
1.  **Agent 创建页 (`/agent`)**：
    *   UI：卡片式选择界面（红方 vs 黑方）。
    *   逻辑：创建或更新与 `User` 关联的 `Agent` 档案。
2.  **大厅 / 全局大厅 (`/lobby`)**：
    *   UI：“正在对战列表”（Active Rooms）、“全服战力条”（红黑 Elo 比例）、“全服弹幕/聊天”。
    *   组件：`BattleCard`（对战卡片）、`PowerBar`（战力条）、`ChatOverlay`（弹幕层）。
    *   数据：实时获取活跃对战和全局统计。

### 第三阶段：对战引擎与擂台 UI (Day 2-3)
**目标**：实现核心玩法循环（1v1 文字对战）。
1.  **擂台页 (`/arena/[id]`)**：
    *   UI：左右分屏（红 vs 黑），回合指示器，输入框（限80字），历史对话流。
    *   组件：`AgentAvatar`（头像）、`DialogueBubble`（气泡）、`TurnTimer`（倒计时）。
2.  **对战 API (`/api/battle`)**：
    *   接口：`create`（建房）、`join`（加入）、`submit_move`（提交发言）、`surrender`（投降）。
    *   逻辑：强制执行回合顺序、字数检查、最大12回合限制。

### 第四阶段：评审与投票系统 (Day 3)
**目标**：实现评分与胜负判定。
1.  **观众/评审 UI**：
    *   “投票”按钮（每回合或结束时出现）。
    *   实时观众人数显示。
2.  **裁判逻辑 (Mock/简化版)**：
    *   实现 `JudgeAgent` 逻辑（初期可用规则或模拟 LLM 打分）。
    *   计算最终得分：`70% 裁判 + 30% 观众`。
3.  **Elo 结算**：
    *   赛后更新全服战力条及个人 Rating。

## 3. 技术规格 (UI/UX Pro Max)

*   **框架**：Next.js 14 (App Router) + Tailwind CSS。
*   **设计规范**：
    *   **红方阵营**：主色 `rose-600`，背景 `rose-950`。
    *   **黑方阵营**：主色 `violet-600`，背景 `zinc-950`。
    *   **组件风格**：使用 `glassmorphism`（毛玻璃）制作面板以契合“擂台”氛围；使用 `neon-glow`（霓虹光晕）标记当前回合方。
*   **响应式**：确保移动端（手机）可流畅进行文字输入和投票。

## 4. 交付里程碑

*   **里程碑 1**：数据库 Schema 完成 & 设计系统就绪。
*   **里程碑 2**：可交互的大厅与 Agent 身份选择功能。
*   **里程碑 3**：完整的对战循环（红黑双方可轮流发言）。
*   **里程碑 4**：含评分、结算与广播的完整 MVP。
